# Copia a .env (o a otro archivo y usa ENV_FILE=...) y rellena los valores.
# Nota: algunos scripts (seed/auditorías) corren via ts-node/register y también respetan ENV_FILE.

# -----------------------------
# Core runtime (requerido)
# -----------------------------

# Environment: development | production | test
NODE_ENV=development

# Puerto del backend
PORT=5001

# URL del frontend (links/redirects)
# Local: http://localhost:3000 | Prod: https://thebearbeat.com
CLIENT_URL=http://localhost:3000

# Base de datos (Prisma)
# Local STAGING (backend/docker-compose.staging.yml):
# mysql://root:root@127.0.0.1:3310/bearbeat_staging
DATABASE_URL=mysql://root:root@127.0.0.1:3310/bearbeat_staging

# JWT para sesiones (NO reutilizar entre ambientes)
JWT_SECRET=test-secret

# Redis (colas BullMQ)
REDIS_HOST=127.0.0.1
REDIS_PORT=6380
COMPRESSION_QUEUE_NAME=bearbeat_compression
REMOVE_USERS_QUEUE_NAME=bearbeat_remove_users
MANYCHAT_RETRY_QUEUE_NAME=bearbeat_manychat_retry
MANYCHAT_RETRY_ATTEMPTS=6
MANYCHAT_RETRY_BACKOFF_MS=5000
MANYCHAT_RETRY_CONCURRENCY=2
WEBHOOK_INBOX_QUEUE_NAME=bearbeat_webhook_inbox
WEBHOOK_INBOX_CONCURRENCY=4
WEBHOOK_INBOX_SWEEP_INTERVAL_MS=60000
WEBHOOK_INBOX_SWEEP_BATCH_SIZE=100
WEBHOOK_INBOX_STALE_ENQUEUED_MS=300000
WEBHOOK_INBOX_MAX_ATTEMPTS=12
WEBHOOK_INBOX_RETRY_BASE_MS=30000
WEBHOOK_INBOX_RETRY_CAP_MS=21600000

# CORS (opcional; si se omite hay defaults seguros para localhost + thebearbeat.com)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:4173

# Sentry (monitoreo de errores en backend)
SENTRY_DSN=
SENTRY_BACKEND_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=
SENTRY_DEBUG=0
SENTRY_SAMPLE_RATE=1
SENTRY_CAPTURE_DEV_ERRORS=0
SENTRY_TRACES_SAMPLE_RATE=0
SENTRY_PROFILES_SAMPLE_RATE=0

# Analytics (internal events)
# Used to hash client IPs before writing analytics_events.ip_hash.
# Set this in production (do not reuse JWT secrets across environments).
ANALYTICS_IP_SALT=

# Meta / Facebook (Conversions API)
# Tokens/IDs se configuran en el backend (server-side). No pongas esto en el frontend.
FACEBOOK_ACCESS_TOKEN=
FACEBOOK_PIXEL_ID=

# ManyChat handoff (ManyChat -> Web): tokenized links to carry contact context without leaking PII in URLs.
# Create a long random secret and set the same value in ManyChat External Request payload.
MC_HANDOFF_SECRET=
# Token TTL (days). Recommended: 7-30.
MC_HANDOFF_TTL_DAYS=14

# PayPal (API base URLs)
# Live / Sandbox
PAYPAL_URL=
PAYPAL_SANDBOX_URL=

# PayPal (REST credentials)
# Live / Sandbox
PAYPAL_CLIENT_ID=
PAYPAL_CLIENT_SECRET=
PAYPAL_TEST_CLIENT_ID=
PAYPAL_TEST_CLIENT_SECRET=

# PayPal webhooks (IDs del endpoint configurado en PayPal)
# Si solo usas uno, con PAYPAL_WH_ID es suficiente.
PAYPAL_WH_ID=
PAYPAL_TEST_WH_ID=
# Opcional: URL pública del endpoint de webhook. Si no se define, usa
# PAYPAL_WEBHOOK_BASE_URL + /webhooks.paypal
PAYPAL_WEBHOOK_BASE_URL=https://thebearbeatapi.lat
# Opcional: override explícito por ambiente
PAYPAL_WEBHOOK_URL=
PAYPAL_TEST_WEBHOOK_URL=

# Stripe (API keys)
# Live / Test
STRIPE_KEY=
STRIPE_TEST_KEY=
STRIPE_API_VERSION=

# Stripe webhooks (signing secrets)
STRIPE_WH_SECRET=
STRIPE_WH_PI_SECRET=
STRIPE_WH_PRODUCTS_SECRET=

# Stripe (OXXO) - separate account keys
# Usar solo para pagos en efectivo (OXXO). No afecta la cuenta Stripe principal.
STRIPE_OXXO_KEY=
STRIPE_OXXO_TEST_KEY=
STRIPE_OXXO_API_VERSION=

# Stripe (OXXO) webhook signing secret for payment_intent.* events
STRIPE_OXXO_WH_PI_SECRET=

# Stripe (OXXO) voucher expiration (days). Default: 3
STRIPE_OXXO_EXPIRES_AFTER_DAYS=3

# Conekta (API keys)
# Producción / Pruebas
CONEKTA_KEY=
CONEKTA_TEST_KEY=
# Para verificación de firma en webhooks (Signed key)
CONEKTA_SIGNED_KEY=
CONEKTA_SIGNED_TEST_KEY=

# Conekta (legacy / migración UH)
CONEKTA_UH_KEY=
CONEKTA_UH_TEST_KEY=

# Conekta (cash methods)
# 0 = disabled | 1 = enabled
CONEKTA_OXXO_ENABLED=0
# 0 = disabled | 1 = enabled
CONEKTA_PBB_ENABLED=0

# Free trial (Stripe only)
# Apply only to users with no previous paid plan orders.
# NOTE: Only card payments (Stripe) can auto-charge after the trial.
BB_TRIAL_DAYS=0
BB_TRIAL_GB=100

# Track metadata (explorador: BPM/clave/formato/versión + portada opcional Spotify)
# Ruta base del catálogo FTP que se indexa (requerido para metadata:scan).
SONGS_PATH=
# Ruta donde se guardan y sirven los demos (/demos). Si está vacía usa ./demos.
DEMOS_PATH=
# Base URL opcional para servir demos desde CDN (ej. https://media.tudominio.com).
MEDIA_CDN_BASE_URL=
# Cache headers para demos.
DEMOS_CACHE_CONTROL=public, max-age=1800, stale-while-revalidate=120
# Opcional: cache específico para CDN/proxies.
DEMOS_CDN_CACHE_CONTROL=
DEMOS_SURROGATE_CONTROL=
# Rate-limit suave para /demos (0 desactiva).
DEMOS_RATE_LIMIT_MAX=180
DEMOS_RATE_LIMIT_WINDOW_MS=10000
DEMOS_RATE_LIMIT_BLOCK_MS=10000
# 0 = no escanear al iniciar | 1 = reconstruir índice de metadata al boot.
TRACK_METADATA_SCAN_ON_BOOT=0
# Escaneo incremental periódico para detectar nuevas subidas automáticamente.
# 0 desactiva; recomendado: 60 (cada 60 minutos).
TRACK_METADATA_SCAN_INTERVAL_MINUTES=60
# Tamaño de lote para createMany durante metadata:scan.
TRACK_METADATA_SCAN_CHUNK_SIZE=500
# 0 = no Spotify | 1 = habilita búsqueda de portadas con Client Credentials.
TRACK_METADATA_SPOTIFY_ENABLED=0
# 0 = no backfill durante metadata:scan | 1 = intenta portadas tras reconstrucción.
TRACK_METADATA_SPOTIFY_SCAN_ON_REBUILD=0
# Máximo de tracks por corrida para Spotify backfill.
# Usa un entero > 0 (ej. 400) para acotar llamadas.
TRACK_METADATA_SPOTIFY_SCAN_MAX=400
# Máximo por llamada rápida (enriquecimiento async al listar carpeta).
TRACK_METADATA_SPOTIFY_MAX_PER_CALL=6
# Reintento (horas) para tracks marcados como spotify_miss.
TRACK_METADATA_SPOTIFY_MISS_RETRY_HOURS=24
# Spotify API (server-side only; nunca en frontend).
SPOTIFY_CLIENT_ID=
SPOTIFY_CLIENT_SECRET=
# Mercado para /v1/search (ISO country code, ejemplo: MX, US).
SPOTIFY_MARKET=MX

# Amazon SES (email)
# NOTE: Identities + sandbox/production access are region-scoped in SES.
AWS_REGION=us-east-2
# If you are not running on AWS (no IAM Role), set these too:
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
SES_FROM_EMAIL=
SES_FROM_NAME=
# Email delivery mode:
# - In production runtime: defaults to "ses"
# - In dev/staging/test: forced to "sink" (never sends real emails)
EMAIL_DELIVERY_MODE=ses
# Optional: when EMAIL_DELIVERY_MODE=sink, write captured payloads to this directory.
# Do not set this in production.
EMAIL_SINK_DIR=
# Public backend URL used in emails (unsubscribe links, etc.)
PUBLIC_API_URL=https://thebearbeatapi.lat
# Secret used to sign unsubscribe links (generate a long random string).
EMAIL_PREFERENCES_SECRET=
# Optional: separate secret for expiring magic links (billing portal, preferences center, etc).
# If omitted, EMAIL_PREFERENCES_SECRET will be used as a fallback.
EMAIL_LINKS_SECRET=

# Kill switch: set to 0 to stop ALL automated email sequences/campaigns (no deploy required).
EMAIL_AUTOMATIONS_ENABLED=1

# Dunning (failed subscription payments)
# 0 = disabled (recommended until you validate staging)
# 1 = enabled
DUNNING_ENABLED=0
# How far back to look for payment_failed events (days)
DUNNING_LOOKBACK_DAYS=30

# Analytics alerts (cron/script)
ANALYTICS_ALERTS_DAYS=14
ANALYTICS_ALERTS_EMAIL_TO=

# Synthetic monitoring (Playwright canary)
CANARY_BASE_URL=http://localhost:3000
CANARY_USERNAME=
CANARY_PASSWORD=
CANARY_TIMEOUT_MS=45000
CANARY_HEADLESS=1
