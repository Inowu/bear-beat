.preview-modal {
  .modal-dialog {
    max-width: 720px;

    .modal-content {
      background: var(--app-bg-card);
      color: var(--app-text-body);
      border: 1px solid var(--app-border);
      box-shadow: var(--app-shadow-card);

      .modal-header {
        border-color: var(--app-border);

        .modal-title {
          font-size: var(--app-font-size-h2);
          color: var(--app-text-heading);
        }

        .bb-ui-modal__close {
          filter: none;
          opacity: 1;
          background-image: none;
          background: color-mix(in srgb, var(--app-bg-soft) 76%, var(--app-bg-card));
          border-color: color-mix(in srgb, var(--app-accent) 32%, var(--app-border));
          color: color-mix(in srgb, var(--app-text-heading) 96%, white);
          box-shadow:
            0 6px 14px rgba(2, 6, 23, 0.16),
            inset 0 1px 0 color-mix(in srgb, var(--color-white) 22%, transparent);

          svg {
            width: 18px;
            height: 18px;
            color: inherit;
            stroke-width: 2.2;
          }

          &:hover {
            border-color: color-mix(in srgb, var(--app-accent) 48%, transparent);
            background: var(--theme-accent-soft-bg);
            color: var(--app-text-heading);
          }

          &:focus-visible {
            outline: 2px solid var(--app-focus-ring);
            outline-offset: 2px;
          }
        }
      }
      .modal-body {
        display: flex;
        flex-direction: column;
        gap: 14px;

        .preview-meta {
          h4 {
            margin: 0;
            color: var(--app-text-heading);
            font-size: 1.08rem;
            font-weight: 700;
            line-height: 1.35;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          p {
            margin: 4px 0 0;
            color: var(--app-text-muted);
            font-size: 0.95rem;
            font-weight: 600;
          }
        }

        .preview-container {
          border-radius: 12px;
          border: 1px solid var(--app-border);
          background: color-mix(in srgb, var(--app-bg-soft) 78%, transparent);
          padding: 10px;

          audio {
            width: 100%;
            margin-block: 0;
            min-height: 46px;
          }

          video {
            width: 100%;
            border-radius: 10px;
          }
        }

        .preview-container.is-audio {
          padding: 14px;
        }

        .preview-container.is-video {
          video {
            max-height: 62vh;
            object-fit: contain;
          }
        }

        .preview-audio-shell {
          display: flex;
          flex-direction: column;
          gap: 10px;
        }

        .preview-audio-native-shell {
          display: grid;
          gap: 10px;
        }

        .preview-waveform-shell {
          position: relative;
        }

        .preview-waveform {
          width: 100%;
          min-height: 104px;
          border-radius: 11px;
          border: 1px solid color-mix(in srgb, var(--app-border) 78%, transparent);
          background: color-mix(in srgb, var(--app-bg-card) 88%, transparent);
          overflow: hidden;
        }

        .preview-wave-placeholder {
          position: absolute;
          inset: 0;
          pointer-events: none;
          display: flex;
          align-items: flex-end;
          justify-content: center;
          gap: 4px;
          padding: 18px 14px;
          opacity: 0.85;
        }

        .preview-wave-placeholder span {
          width: 100%;
          flex: 1 1 0;
          min-width: 2px;
          border-radius: 999px;
          background: color-mix(in srgb, var(--app-accent) 70%, transparent);
          height: 20%;
          transform-origin: bottom;
          animation: preview-eq 1.15s ease-in-out infinite;
          animation-delay: calc(var(--i, 0) * 70ms);
        }

        .preview-wave-placeholder:not(.is-playing) span {
          animation-play-state: paused;
          height: 22%;
          opacity: 0.5;
        }

        .preview-audio-controls {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 10px;
        }

        .preview-audio-toggle {
          min-height: 44px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          padding: 0 12px;
          border-radius: 999px;
          border: 1px solid color-mix(in srgb, var(--app-accent) 42%, transparent);
          background: var(--theme-accent-soft-bg);
          color: var(--app-accent);
          font-size: 0.96rem;
          font-weight: 700;
          transition: border-color 0.16s ease, background 0.16s ease;

          &:hover:not(:disabled) {
            border-color: color-mix(in srgb, var(--app-accent) 58%, transparent);
            background: var(--theme-accent-soft-bg-2);
          }

          &:disabled {
            opacity: 0.6;
            cursor: not-allowed;
          }
        }

        .preview-audio-time {
          color: var(--app-text-muted);
          font-size: 0.95rem;
          font-weight: 700;
          font-variant-numeric: tabular-nums;
        }

        .preview-wave-help {
          margin: 0;
          color: var(--app-text-muted);
          font-size: 0.9rem;
          line-height: 1.4;
        }

        .preview-wave-error {
          margin: 0;
          color: var(--app-status-danger, var(--color-danger-500));
          font-size: 0.92rem;
          font-weight: 700;
          line-height: 1.4;
        }

        .preview-video-error {
          margin-top: 10px;
          display: grid;
          gap: 6px;
        }

      }

      .modal-footer {
        border-color: var(--app-accent);
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;

        p {
          margin: 0;
          color: var(--app-text-body);
          font-size: 0.98rem;
          line-height: 1.45;
          flex: 1;
          min-width: 220px;
        }

        .btn {
          min-width: 120px;
          min-height: 44px;
          font-weight: 700;
        }
      }
    }
  }
}

@media (max-width: 640px) {
  .preview-modal .modal-dialog .modal-content .modal-footer {
    flex-direction: column;
    align-items: stretch;

    .btn {
      width: 100%;
    }
  }

  .preview-modal .modal-dialog .modal-content .modal-body {
    .preview-audio-controls {
      flex-direction: column;
      align-items: stretch;
    }

    .preview-audio-toggle {
      width: 100%;
    }
  }
}
