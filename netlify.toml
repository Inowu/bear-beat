# Build desde la raíz del monorepo para que publish sea frontend/dist (Vite)
[build]
  base = "."
  command = "npm run build"
  publish = "frontend/dist"

[build.environment]
  NODE_VERSION = "24"
  CI = "false"
  REACT_APP_ENVIRONMENT = "production"

  # PayPal (clientId es público; requerido para que se rendericen los botones)
  REACT_APP_PAYPAL_CLIENT_ID = "AYuKvAI09TE9bk9k1TuzodZ2zWQFpWEZesT65IkT4WOws9wq-yfeHLj57kEBH6YR_8NgBUlLShj2HOSr"
  REACT_APP_PAYPAL_CLIENT_TEST_ID = "Afu3XeDQNkiDP08dsJuEjeQf6swc8hW6nBPdhXljD0Ra0XK5bewP2EGrbcei3u0-Fx_tcKUZDWuZWuWC"

  # Hotjar (2026) puede venir como tag de Contentsquare UXA.
  # No es un secreto (es un ID de tag / script público).
  REACT_APP_CONTENTSQUARE_TAG_ID = "6e820b371a0f9"
  REACT_APP_HOTJAR_ENABLED = "1"
  # 0 = solo conversión (recomendado) | 1 = todo el sitio (excepto /admin)
  REACT_APP_UX_TRACK_ALL = "0"

[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    # Clickjacking protection (primary) + legacy support.
    Content-Security-Policy = "default-src 'self' https: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com https://www.paypal.com https://www.paypalobjects.com https:; connect-src 'self' https: wss: https://m.stripe.network https://api.stripe.com https://www.paypal.com https://www.paypalobjects.com; frame-src 'self' https://js.stripe.com https://hooks.stripe.com https://checkout.stripe.com https://www.paypal.com https://*.paypal.com https://challenges.cloudflare.com; img-src 'self' data: blob: https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' data: https:; frame-ancestors 'none';"
    X-Frame-Options = "DENY"
    # Disable high-risk browser features not needed by the site.
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), usb=()"
    X-Permitted-Cross-Domain-Policies = "none"
    # Shell HTML must never stay stale between deploys (prevents old HTML pointing to missing chunks).
    # Hashed assets are long-term cached (see /assets/* below).
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"
    Pragma = "no-cache"
    Expires = "0"

[[headers]]
  for = "/index.html"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"
    Pragma = "no-cache"
    Expires = "0"

[[headers]]
  for = "/manifest.json"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"

[[headers]]
  for = "/asset-manifest.json"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"

[[headers]]
  for = "/service-worker.js"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"

[[headers]]
  for = "/sw.js"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, max-age=0"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
